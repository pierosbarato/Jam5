<html>

<head>
<meta charset="utf-8">
<meta name = "viewport" content = "width=device-width, minimum-scale=1.0, maximum-scale = 1.0, user-scalable = no">
<title>Jam Formula</title>
<link rel="icon" href="favicon.ico" />
<style type="text/css">
	:root {--nest-size: 25px;}
	:root {--nest-size2: 18px;}
</style>

<link rel="stylesheet" href="neumorphism.css">

<!-- Font Awesome -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">

<link rel="stylesheet" href="https://rawgit.com/bevacqua/dragula/master/dist/dragula.css">

<style>
.nested {
	display: inline-flex;
	padding: 1px 0;
	min-width: 30px;
	min-height: 30px;
/*	border: 2px dotted blue; */
	border-radius: .55rem;
	border:.0625rem solid #d1d9e6;
	box-shadow: 6px 6px 12px #b8b9be,-6px -6px 12px #fff!important;
}
.item {
	display: inline-flex;
	padding: 4px;
	margin-right: 3px;
	align-items: center;
}
.jambvox {
	border-radius: .55rem;
	border:.0625rem solid #d1d9e6;
	box-shadow: 6px 6px 12px #b8b9be,-6px -6px 12px #fff!important;
}
</style>

</head>
<body>

<main>

<section class="section section bg-soft pb-5 overflow-hidden z-2">
<div class="container z-2">

<div class="row justify-content-center text-center pt-6">

<div class="col-lg-6 col-xl-6  text-left">
	<div class="alert alert-danger shadow-soft mb-4 mb-lg-5" role="alert">
	<span class="alert-inner--icon icon-lg">
	<span class="fas fa-exclamation-circle"></span></span>
	<span class="alert-heading">Source Pad</span>
		<div class="container nested" id="left">
		  <div class="nested">
			<div class="item">
				Const
				<input class="jambox" oninput="this.setAttribute('size', this.value.length)" />
			</div>
			</div>

		  <div class="nested">
			<div class="item">
				Item
				<div class="nested"></div>
			</div>
			</div>

		  <div class="nested">
			<div class="item">
				<div class="nested"></div>
				+
				<div class="nested"></div>
			</div>
			</div>
			
			<div class="nested">
			<div class="item">
				<div class="nested"></div>
				/
				<div class="nested"></div>
			</div>
			</div>
			
			<div class="nested">
			<div class="item">
				<div class="nested"></div>
				*
				<div class="nested"></div>
			</div>
			</div>
			
		</div>
	</div>
</div>

<div class="col-lg-6 col-xl-6 text-left">
<div class="alert alert-secondary shadow-soft mb-4 mb-lg-5" role="alert">
	<span class="alert-inner--icon icon-lg">
	<span class="fas fa-exclamation-circle"></span></span>
	<span class="alert-heading">Scratch Pad</span>
	<div class="container nested" id="right">
   		<div id="element1">One</div>
	</div>
</div>
</div>

<div class="col-lg-10 col-xl-10">

<div class="alert alert-danger shadow-soft mb-4 mb-lg-5" role="alert">

  <div class="nested">
    <div class="item">
      Item1
      <div class="nested">
        <div class="item">
          Item4
          <div class="nested">
            <div class="item">
              Item7
              <div class="nested"></div>
            </div>
            <div class="item">
              Item8
              <div class="nested"></div>
            </div>
            <div class="item">
              Item9
              <div class="nested"></div>
            </div>
          </div>
        </div>
        <div class="item">
          Item5
          <div class="nested"></div>
        </div>
        <div class="item">
          Item6
          <div class="nested"></div>
        </div>
      </div>
    </div>
    <div class="item">
      Item2
      <div class="nested"></div>
    </div>
    <div class="item">
      Item3
      <div class="nested"></div>
    </div>
  </div>
</div>

</div></div></div>
</section>

</main>
<!-- JQuery -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script type="text/javascript" src="https://rawgit.com/bevacqua/dragula/master/dist/dragula.js"></script>

<script>
(function() {
	  dragula([].slice.apply(document.querySelectorAll('.nested')));
	})();
</script>

<script>
	var dragAndDrop = {
		store : [],

		init : function() {
			self = this;
			this.dragula();
			this.eventListeners();

			if (localStorage.getItem('store'))
				this.store = JSON.parse(localStorage.getItem('store'));

			// querySelectorAll returns a nodelist and should be converted to array to use filter, map and foreach  
			var nodesArray = Array.prototype.slice.call(document
					.querySelectorAll("#left div"));

			var nodesArray = nodesArray.filter(function(e) {
				return self.store.map(function(d) {
					return d['element'];
				}).indexOf(e.id) === -1;
			}).forEach(function(e) {
				self.store.push({
					'element' : e.id,
					'container' : 'left'
				});
			});

			this.store.forEach(function(obj) {
				document.getElementById(obj.container).appendChild(
						document.getElementById(obj.element));
			});
		},

		eventListeners : function() {
			this.dragula.on('drop', this.dropped.bind(this));
		},

		dragula : function() {
			this.dragula = dragula([ document.getElementById('left'),
					document.getElementById('right') ], {
				copy : false,
			});
		},

		dropped : function(el, target, source, sibling) {
			// Remove element from store if it exists
			var indexEl = this.store.map(function(d) {
				return d['element'];
			}).indexOf(el.id);
			if (indexEl > -1)
				this.store.splice(indexEl, 1);

			var indexDrop = this.store.length;
			if (sibling) { // If sibling store before sibling          	
				indexDrop = this.store.map(function(d) {
					return d['element'];
				}).indexOf(sibling.id);
			}

			this.store.splice(indexDrop, 0, {
				'element' : el.id,
				'container' : target.id
			});

			localStorage.setItem('store', JSON.stringify(this.store));
		}
	}

//	dragAndDrop.init();
</script>


</body>
</html>